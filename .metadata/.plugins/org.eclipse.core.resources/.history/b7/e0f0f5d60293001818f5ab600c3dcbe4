package com.teljdbc.service;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import com.teljdbc.dao.TelDao;
import com.teljdbc.po.Telephone;

/**
 * @Description: 业务类：负责业务处理
 * @author chaoling
 * @date 2018年7月29日下午1:38:29
 */
public class TelService {

	TelDao dao = new TelDao();
	List<Telephone> tels = new ArrayList<>();
	/**
	 * @Description: 添加业务处理
	 * @param telephone
	 * @return boolean    
	 */
	public boolean addTel(Telephone telephone) {
		return dao.insert(telephone);
	}

	
	public boolean deleteTelByName(String name) {
		
		return dao.delete(name);

	}

	/**
	 * @Description: 根据姓名更新
	 * @param telephone
	 * @param name
	 * @return     
	 * @throws
	 */
	public boolean updateTel(Telephone telephone, String name) {

		return dao.update(telephone,name);
	}

	/**
	 * @Description: 查询所有
	 * @return tels  
	 * @throws
	 */
	public List<Telephone> selectAllTel() {

		return tels;
	}

	// 根据姓名查询
	// 参数：String
	// 返回值：Telephone
	public Telephone selectTelByName(String name) {

		// 1.得到此名字电话本的索引
		int index = selectIndexByName(name);

		// 如果不等于-1 找到了，返回具体的电话本
		if (index != -1) {
			return tels.get(index);
		}
		// 没找到，返回null
		return null;
	}

	public int selectIndexByName(String name) {

		// 遍历查找，存在返回索引
		for (int i = 0; i < tels.size(); i++) {
			if (tels.get(i).getName().equals(name))
				return i;
		}
		// 不存在返回-1
		return -1;
	}

	/**
	 * @Description: 初始化，即读入数据   
	 * @param pathname     
	 * @throws
	 */
	public void init() {
		
		tels = dao.select();
	}
	/**
	 * 
	 * @Description: 写入操作
	 * @param pathname     
	 * @throws
	 */
	public void exit(String pathname) {
		
		BufferedWriter bw = null;
		
		try {
			bw = new BufferedWriter(new FileWriter(pathname));
			
			Iterator<Telephone> iterator = tels.iterator();
			
			while(iterator.hasNext()){
				bw.write(iterator.next().toString());
				bw.newLine();
				bw.flush();
			}
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if(bw !=null)
				try {
					bw.close();
				} catch (IOException e) {
					e.printStackTrace();
				}
		}
	}

}
